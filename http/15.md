# 15. 엔터티와 인코딩
## 15.1 메시지는 컨테이너, 엔티티는 화물
- 엔티티 헤더 : 18자 짜리 플레인 텍스트 문서, CRLF 로 헤더와 필드 구분
- HTTP/1.1 이 정의한 엔티티 헤더 필드
  - Content-Type
  - Content-Length
  - Content-Language: 전달된 객체에 대응되는 자연어
  - Content-Encoding
  - Content-Location
  - Content-Range : 이 엔티티가 부분 엔티티라면, 이 엔티티가 전체에서 어느 부분에 해당하는지
  - Content-MD5 엔티티 본문의 컨텐츠에 대한 체크섬
  - Last-Modified
  - Expires
  - Allow : 허용되는 메서드
  - ETag : 이 인스턴스에 대한 고유한 검사기, 엄밀히 말해 이건 엔티티 헤더로 정의되어 있지는 않지만, 엔티티 관련 많은 동작을 위해 중요한 헤더
  - Cache-Control : 캐싱때 배운, 캐시 관련 지시 헤더
### 엔티티 본문
- 가공되지 않은 데이터만을 담고있다
- 다른 정보들은 모두 헤더에 담김
- raw data를 엔티티 헤더를 보고 어떻게 해석할 지 아는것
- 헤더 필드 이후의 CRLF 이후 엔티티 본문 시작
### Content-Length: 엔티티의 길이
- 엔티티 본문의 크기를 바이트 단위로 나타냄
- 압축된 파일이라면 압축 후의 크기를 나타냄
- 메시지 잘림 문제 인지를 Content-Length 보고 파악함
- 캐시는 잘린 메시지를 캐싱하지 않기 위해, Content-Length 헤더 갖고있지 않는 http 본문은 보통 캐싱 안함
### 잘못된 Content-Length
- 이게 잘못된 값이면 매우 큰 피해 유발 가능
- 공식적으로 이게 잘못되어 있다면, 사용자에게 알려주게 되어있음
### 지속 커넥션
- Content-Length 는 지속 커넥션을 위해 필수(청크 인코딩 떄는 또 필요없다고함)
### 컨텐츠 인코딩
- 컨텐츠가 인코딩되어 있는 경우 인코딩 후의 본문 길이를 바이트 단위로 정의함
- 근데 1.1 명세에 없는 거라 문제 생길 때도 있음
### 엔티티 본문 길이 판별을 위한 규칙
- 본문 길이 판별을 위한 수칙으로, 나열된 순서대로 적용
1. 본문을 갖는것이 허용안된 http 메시지에는 Content-Length 헤더가 무시됨(ex. HEAD)
2. Transfer-Encoding 헤더를 포함하고 있다면, 메시지가 커넥션이 닫혀서 먼저 끝나지 않는 이상 `0바이트 청크` 패턴으로 끝나야 함.
3. Conteng-Length 헤더 갖는다면, Trnsfer-Encoding 존재하지 않는 이상 이 값은 본문의 길이를 담음.
4. `multipart/byteranges` 미디어타입을 사용하고 Content-Length 없다면, 멀티파트 메시지 각자가 스스로의 크기를 정의할 것
5. 위의 어떤 규칙도 해당하지 않는다면, 엔티티는 커넥션이 닫힐 때 끝남. 서버만이 커넥션 종료 가능함
6. HTTP/1.0과의 호환을 위해 엔티티 보눈을 갖고있는 HTTP/1.1 요청은 반드시 유효한 Content-Length 헤더도 갖고있어야 함(3번에 왜안걸려)

## 15.4 미디어 타입과 차셋(Charset)
- Content-Type 헤더는 엔티티 본문의 MIME(전달되는 데이터 매체의 기저 형식) 기술함
- 이 헤더의 값은 IANA 에 등록된 표준화된 MIME타입
- MIME 는 `주 미디어타입/구체적인 부 타입` 으로 구성됨(ex. text/html, image/jpeg, multipart/byteranges 등)
### 멀티파트 미디어 타입
- 서로 붙어있는 여러개의 메시지를 포함하며, 하나의 복합 메시지로 보내짐
- 각 구성요소가 자족적으로 자신에 대해 서술하는 헤더를 포함함
- 문자열 하나로 서로의 경계가 식별됨
- 일반적으로 폼을 채워서 제출할 때, 문서의 일부분을 실어나르는 범위 응답을 할때 사용(난 csv 파일 다운로드때 사용했는데 머지)
## 15.5 콘텐츠 인코딩
- 떄떄로 느린 클라이언트에게 큰 html 전송 전에 미리 인코딩 하기도 함
- 혹은 제3자가 못보게 컨텐츠를 암호화하는 경우도 있음
- 이러한 종류의 인코딩은 발송하는 쪽에서 컨텐츠에 적용함
- 
