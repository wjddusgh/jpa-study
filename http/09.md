# 8. 통합점: 게이트웨이, 터널, 릴레이
- http 는 웹에 있는 모든 리소스에 대한 프로토콜로 사용되며, 애플리케이션간 서로 다른 프로토콜을 상호 운용하는 용도로도 사용

## 8.1 게이트웨이
- 웹 리소스가 복잡해지며, 모든 리소스를 한 애플리케이션으로만 처리할 수 없어짐
- 리소스를 받기 위한 경로를 안내하는 역할의 게이트웨이 고안
- 게이트웨이 : 리소스 <> 애플리케이션 연결
- 동적인 컨텐츠 생성, db 질의 가능
### 웹 게이트웨이
- 한쪽에선 http, 다른쪽에선 다른 프로토콜로 통신
- `<클라이언트 프로토콜>/<서버 프로토콜>`
  - `HTTP/NNTP`
  - `HTTP/FTP`
- 서버측 게이트웨이 : 클라이언트와 http 로 통신, 서버와는 외래 프로토콜로 통신
- 클라측 게이트웨이 : 클라이언트와 외래 프로토콜로 통신, 서버와 http 로 통신
### 8.2 프로토콜 게이트웨이
- http 트래픽을 바로 게이트웨이에 보낼 수 있다
- 브라우저가 특정 프로토콜에 게이트웨이 설정
### HTTTP/*: 서버 측 웹 게이트웨이
- 클라이언트로부터 http 요청이 원 서버로 들어오는 시점에 요청을 외래 프로토콜로 전환
- 게이트웨이가 하는 일
  - USER, PASS 명령을 보내 서버에 로그인
  - CWD 명령을 내려 서버에서 적절한 디렉토리로 변경
  - 다운로드 형식 ASCII로 설정
  - MDTM으로 문서 최근 수정시간 가져옴
  - PASV로 서버에서 수동형 데이터 검색 하겠다 말함
  - RETR로 객체 검색
  - 반환된 포트로 FTP 서버에 데이터 커넥션 맺고 객체가 게이트웨이로 전송됨
- HTTP/HTTPS 게이트웨이 : 기업 내부의 요청을 암호화함으로 개인정보 보호, 보안
- HTTPS/HTTP 게이트웨이 : 보안 가속기, 인터셉트나 프록시 역할, 보안 트래픽 복호화하는 하드웨어 내장해서 원서버 부하 줄여주기도 하지만, 게이트웨이<>서버간 트래픽은 암호화되지 않은 상태
## 8.3 리소스 게이트웨이
- CGI : 웹 서버와 애플리케이션 간의 통신방식, 최초의 api
  - 웹 서버와 분리하다보니 모든 cgi 마다 새로운 프로세스 만드는 비용 커져서 서버 성능 제한하게됨
### 서버 확장 api
- 웹 개발자가 모듈을 http와 직접 연결할 수 있는 강력한 인터페이스

## 8.4 애플리케이션 인터페이스와 웹 서비스
- 두 애플리케이션 사이의 데이터 교환시 프로토콜 인터페이스를 어떻게 맞출까?
- SOAP : XML 을 담음
- REST : XML도 되긴 하지만, 주로 JSON 을 담음
## 8.5 터널
- 웹 터널 : http 지원 안하는 애플리케이션에 http 사용해 접근하는 방법 제공
- 다른 프로토콜을 http 위에 올리는 것
### CONNECT로 HTTP 터널 커넥션 맺기
- http 의 connect 메서드(http/1.1 명세에 예약은 되어있지만 기능 설명 없다. 하지만 많이들 구현하는 확장임) 사용하여 커넥션 맺음
- connect 통해 http 위에서 tcp 커넥션 가능
- connect 요청 성공시 `200 Connection Established` 반환
- 커넥션이 메시지 대신 바이트를 전달하기에 컨텐츠 형식(Content-Type)헤더 필요없다
- 터널을 통해 전달되는 데이터는 게이트웨이에서 볼 수 없다
- 성능을 위해 커넥션 응답 받기전부터 데이터 전송 가능, 이는 뭔가 문제생겨도 다시 보낼 준비가 되어있어야 함을 의미
### SSL 터널링
- 원래, 보안을 위해 모든 트래픽이 패킷을 필터링하는 라우터와 프록시를 지나도록 했는데, SSL 같이 암호화된 프로토콜에서는 처리가 안됨
- 그래서 터널 사용해서 ssl 트래픽을 http 커넥션으로 전송하여 방화벽 통과시키는걸로 웹 터널 개발됨
- 터널 사용하다보면 악의적인 트래픽이 보안넘어 안으로 유입되는 경로가 될 수도 있다
### SSL 터널링 vs HTTP/HTTPS 게이트웨이
- 게이트웨이 쓰면 SSL을 위한 프록시 구현이 필요하지만, 터널링은 필요없다
### 터널 인증
- 터널 사용 전에 프록시 인증을 붙여 인증 기능 추가할 수 있다
### 주의할 점
- 터널 게이트웨이는 악용될 소지가 있다
- 오용 최소화를 위해 게이트웨이는 https 전용 포트인 443 같이 잘 알려진 특정 포트만을 터널링 할 수 있게 해야한다
## 8.6 릴레이
- 릴레이 : http 명세를 완전히 준수하지는 않는 간단한 http 프록시
- 바이트를 맹목적으로 전달만 함
- 그래서 간단하지만 문제는 엄청 생길 수 있음
- 대부분 클라, 서버가 상대방에 설정을 하는 헤더를 릴레이는 무시해서 그런듯(마치 http 버전 차이에 따른 바보 프록시마냥)
