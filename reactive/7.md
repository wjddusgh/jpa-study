# 7 리액티브 방식으로 데이터베이스 사용하기
- 웹플럭스는 모든 HTTP 요청을 논블로킹 방식으로 처리 가능
- 여기선 스프링 데이터 모듈을 사용해 리액티브 방식으로 데이터에 엑세스 하는 방법 학습

# 최근 데이터 처리 패턴
- 마이크로서비스(msa) 는 대세가 되가는중, 클라우드 네이티브 애플리케이션에서 가장 중요한 스타일
## 도메인 주도 설계
- DDD는 공통 어휘를 설정하고 모델의 무결성을 유지하기 위한 일련의 원칙 공식화
- DDD 관점에서 정의한 각각의 **바운디드 컨텍스트** 가 하나의 마이크로서비스로 매핑됨
- DDD는 비즈니스 핵심 도메인에 집중, 도메인 모델을 표현, 생성, 검색하는 수단에 중점(엔티티, DTO나 VO, aggregate, repository 등)

## 마이크로서비스 시대의 데이터 저장소
- msa 도입으로 영속 계층에 변화가 생김 -> 서비스 간에 데이터 저장소 공유 X
- 논리적으로 분할된 각각의 서비스는 다른 서비스 db 엑세스하려면 api호출 말고는 불가(하는게 이상적)
- 이유
  - db schema와 강한 결합 없이 서비스 계속 진화시켜나가야함
  - 더 섬세한 자원 관리해야함
  - 수평적 확장 가능해야함
  - 가장 적합한 영속 계층 구현 사용할수 있어야함
- 스토리지 분리
  - 스키마로 서비스 분리
    - 구현이 쉽고, 서버 리소스 적게 필요
    - 하나 망가지면 다망가질수도 있음
  - 데이터베이스로 서비스 분리
    - 훨씬 더 많은 관리 필요
    - 특정 서비스의 확장 용이
  - 혼합해서 써도 좋다, 다른 종류의DB도 함께 사용하면 최상의 결과 얻기 가능 -> 이게 **다중 저장소 영속화** 라고함      
  
## 다중 저장소 영속화
- 요즘엔 다양한 db 동시에 사용이 일상임
- RDBMS
  - 동일한 ACID 원칙을 토대로 구축, 거의 유사한 sql 언어 제공
  - 광범위한 응용 프로그램에 적합
  - 그래프 저장, 메모리 내 저장소 및 분산 저장소 등에는 비효율적
- NoSQL
  - 광범위한 기본 원칙 가지고 있어 범용 db로 사용은 효율적이지 않음
  - 몇가지 사례에는 더 나은 기능 제공   
- 다중으로 쓰면 복잡성으로 인해 추가비용 발생, nosql은 자칫하면 멸망함

## 서비스로서의 데이터베이스
- 클라우드용으로 설계되지 않은 db서버를 효율적으로 관리하고 조정하는것은 어려움
- 대부분 클라우드 제공 업체는 **DBaas** 를 제공해서 해결함
- 클라우드 저장소나 db에서 사용하는 알고리즘 방식
  1. 클라이언트가 db 또는 파일 저장소에 액세스 요청(admin 또는 api로)
  2. 클라우드 공급자는 권한 부여, 클라이언트는 api 세부구현 신경x
  3. 클라이언트는 액세스 자격증명 제공하는 스토리지api 또는 db driver 사용
  4. 클라우드 공급자는 클라이언트의 지불 방법, 데이터량, 쿼리 빈도, 등등의 특성에 따라 클라에게 요금 부과
- 관심사의 분리를 통해 서로가 효율적임  

## 마이크로서비스 사이의 데이터 공유
- 둘 이상의 서비스가 가진 데이터를 쿼리해야 하는 경우가 있음
  - 모놀리틱에선 그냥 단일 조인 하면 됨
  - msa에선 곤란
  - 각 서비스의 데이터를 쿼리하고 필요한 데이터를 변환해 집계 결과를 클라이언트에 반환하는 어댑터 서비스를 구현해야함
  - 두 서비스간의 의존성이 강한 경우 합치는것도 고려해야함(도메인 중심 디자인을 안깨는 한에서) 
