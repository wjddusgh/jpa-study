# 4. 엔티티 매핑

JPA를 사용하는데 가장 중요한 일은엔티티와 테이블을 정확히 매핑 하는것\
JPA 애노테이션 4가지 분류
- 객체와 테이블 매핑: @Entity, @Table
- 기본 키 매핑: @Id
- 필드와 컬럼 매핑: @Column
- 연관관계 매핑: @ManyToOne, @JoinColumn

매핑 정보는 XML, 애노테이션 중 골라서 사용하는데 애노테이션이 편한듯

# 4.1 @Entity


|속성|기능|기본값|
|------|---|---|
|name|JPA에서 사용할 이름 지정, 보통 클래스 이름 활용|클래스 이름(ex. Member)|

@Entity 적용 시 주의사항
- 기본 생성자(파라미터가 없는 public 혹은 protected 생성자) 는 필수다
- final 클래스, enum, interface, inner 클래스는 사용할 수 없다
- 저장할 필드에 final 사용 금지
- 자바는 생성자가 아무것도 없으면 기본생성자를 만들어주지만, 무엇하나라도 직접 만들었다면 기본생성자도 같이 만들어줘라

# 4.2 @Table


|속성|기능|기본값|
|------|---|---|
|name|매핑할 테이블 이름|엔티티 이름 사용|
|catalog|catalog 매핑||
|schema|schema 매핑||
|uniqueConstraints(DDL)|DDL 생성 시 유니크 제약 조건 만든다||

# 4.3 다양한 매핑 사용

- @Enumerated : Enum 필드 매핑시 필요
- @Temporal : 날짜 필드 매핑시 필요 
- @Lob : CLOB, BLOB등의 필드 매핑시 필요

# 4.4 데이터베이스 스키마 자동 생성

JPA는 클래스의 매핑정보와 데이터베이스 방언을 사용해서 데이터베이스 스키마를 자동으로 생성하는 기능을 지원한다\
```"hibernate.hbm2dll.auto=true"``` 사용시 애플리케이션 실행시점에 DB 테이블 자동 생성\
```"hibernate.show_sql=true"``` 사용시 만들어진 DDL 콘솔에 출력
- 스키마 자동 생성 기능 사용시 개발자가 테이블을 직접 생성하는 수고를 덜 수 있지만, 완벽하진 않으므로 참고하자
- hibernate.hbm2dll.auto 속성
|옵션|설명|
|------|---|
|create|기존 테이블을 삭제하고 새로 생성 DROP + CREATE|
|create-drop|create에다가 추가로 앱 종료시 생성한 DDL 제거 DROP + CREATE + DROP|
|update|디비 테이블과 엔티티 매핑정보를 비교해서 변경 사항만 수정|
|validate|디비 테이블과 엔티티 매핑정보를 비교해서 차이가 있으면 경고를 남기고 앱 실행 X, 이 설정은 DDL 수정을 안함|
|none|자동생성 기능을 사용하지 않으려면 속성 자체를 삭제하거나 유효하지 않은 옵션 값 주면 된다(none은 유효하지 않은 값)|

- JPA는 2.1 부터 스키마 자동생성기능을 표준으로 지원하지만 update, validate 옵션은 지원하지 않는다
- ```hibernate.ejb.naming_strategy``` 사용시 이름 매핑 전략 사용 가능(카멜케이스 ~ 스네이크케이스)

# 4.5 DDL 생성 기능

제약조건을 추가할 수 있다
- @Column 의 nullable, length를 통해 not null을 주거나 값 제한을 변경할 수 있다
- @Table 의 uniqueConstraints 속성을 통해 유니크 제약 조건을 추가할 수 있다
- 이러한 기능들은 DDL 자동 생성시만 사용되고 JPA의 실행 로직에는 영향을 주지 않는다

# 4.6 기본 키 매핑

